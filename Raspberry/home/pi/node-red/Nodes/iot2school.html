<script type="text/javascript">

    RED.nodes.registerType('IoT-Sensor',{
        category: 'config',
        defaults: {
            IoTSensorName: {value:"",required:true},
        },
        label: function() {
            return this.IoTSensorName;
        }
    });
</script>

<script type="text/x-red" data-template-name="IoT-Sensor">
    <div class="form-row">
        <label for="node-config-input-IoT-Sensor"><i class="icon-bookmark"></i> Sensor </label>
        <input type="text" id="node-config-input-IoTSensorName" placeholder="z.B. LDR">
    </div>

</script>

<!--
 Sensor: Config 
-->
<script type="text/javascript">
    RED.nodes.registerType('Sensor',{
        category: 'IoT4School',
        defaults: {
            
            broker: {type:"mqtt-broker", required:true},
            sensor: {type:"IoT-Sensor", required:true},
            number: {value:"", required:true, validate:RED.validators.number()},
            qos: {value: "1"},
            name: {value:""},
            topic:{value:""},
            
        },
        color:"#00B1C1",
        inputs:0,
        outputs:1,
        icon: "feed.png",
        label: function() {
            return this.name||"Sensor";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        
        oneditprepare: function() {
            if (this.qos === undefined) {
                $("#node-input-qos").val("1");
            }
        }
    });
</script>


<!--
 Sensor: Darstellung
<input type="text" id="node-input-name" placeholder="z.B. LDR2">
-->
<script type="text/x-red" data-template-name="Sensor">

    <div class="form-row">
    
        <label for="node-input-broker">
            <i class="fa fa-globe"></i> 
            Server
        </label>
        
        <input type="text" id="node-input-broker">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-sensor">
            <i class="fa fa-thermometer-3"></i>
            Sensor
        </label>
        
        <input type="text" id="node-input-sensor">
     </div>
     
    <div class="form-row">
        <label for="node-input-number">
            <i class="fa fa-hashtag"></i> 
            Nummer
        </label>
     
        <input type="text" id="node-input-number" placeholder="z.B. 5">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-qos">
            <i class="fa fa-empire"></i>
            QoS
        </label>
        <select id="node-input-qos" style="width:125px !important">
            //Anfang
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-name">
            <i class="fa fa-tag"></i>
            Name
        </label>
        
        <input type="text" id="node-input-name" placeholder="z.B. Temperatur Flur oder TMP5">
        
    </div>
    

    
    
</script>

<!--
 Sensor: Hilfe Text
-->
<script type="text/x-red" data-help-name="Sensor">
    <p>Verbindet sich mit dem Broker und empfängt Daten vom Sensor.</p>
    
    <p>Zunächst müssen MQTT-Broker, Sensortyp und die Sensornummer spezifiziert werden. Beispiele für
    die Sensorenkonfiguratioen wären Termometer1, Wetterstation9 oder Knopf0. Die akutell im Netzwerk verfügbaren Sensoren findest du unter http://[IP-Adresse_des_Servers]/mqttdb.php</p>
    
    <p>Der Sensor-Knoten gibt folgende Parameter aus:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    
    <p>Mittels <code>msg.topic</code> kannst du feststellen, unter welchem Topic die Nachricht versendet wurde. Das Topic hat i.d.R die Form Sensor/NAME/NUMMER</p>
    
    <p>Die interessanten Daten befindet sich im <code>msg.payload</code>. Der Payload wird bei Empfang in ein <strong>JSON Objekt</strong> umgewandelt. Dies ermöglicht es dir den Inhalt der Nachricht unkompliziert auszuwerten und weiter zu verwenden. So kannst du beispielsweise, wenn du weißt, dass der Parameter "Temperatur" im Payload vorhanden ist, diesen über <code>msg.payload.Temperatur</code> auslesen.</p>
    
    <p><code>msg.qos</code> zeigt an mit welchem Aufwand der Sensor versucht hat die Nachricht zum Broker zu senden. Quality of Service 0 bedeutet, dass der Sensor die Nachricht genau ein einziges Mal versendet hat. Ob die Nachricht beim Broker angekommen ist, interessiert den Senosr nicht. QoS 1 bedeutet widerum, dass der Sensor auf eine Empfangsbestätigung vom Broker wartet. So sendet der Sensor so lange ein und die selbe Nachricht bis er sich sicher sein kann, dass diese auch angekommen ist. </p>
    
    <p>Der Parameter <code>msg.retain</code> gibt an, ob der Sensor sich vom Broker wünscht die letzte Nachricht zu archivieren.</p>
</script>





<script type="text/javascript">

    RED.nodes.registerType('IoT-Aktor',{
        category: 'config',
        defaults: {
            IoTAktorName: {value:"",required:true},
        },
        label: function() {
            return this.IoTAktorName;
        }
    });
</script>

<script type="text/x-red" data-template-name="IoT-Aktor">
    <div class="form-row">
        <label for="node-config-input-IoT-Aktor"><i class="icon-bookmark"></i> Aktor </label>
        <input type="text" id="node-config-input-IoTAktorName" placeholder="z.B. LED oder Servo">
    </div>

</script>

<! Status Sensor -->
<script type="text/javascript">
    RED.nodes.registerType('SensorStatus',{
        category: 'IoT4School',
        defaults: {
            
            broker: {type:"mqtt-broker", required:true},
            sensor: {type:"IoT-Sensor", required:true},
            number: {value:"", required:true, validate:RED.validators.number()},
            qos: {value: "1"},
            name: {value:""},
            topic:{value:""},
            
        },
        color:"#00B1C1",
        inputs:1,
        outputs:1,
        icon: "alert.png",
        label: function() {
            return this.name||"Sensor-Status";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        },
        
        oneditprepare: function() {
            if (this.qos === undefined) {
                $("#node-input-qos").val("1");
            }
        }
    });
</script>

<script type="text/x-red" data-template-name="SensorStatus">

    <div class="form-row">
    
        <label for="node-input-broker">
            <i class="fa fa-globe"></i> 
            Server
        </label>
        
        <input type="text" id="node-input-broker">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-sensor">
            <i class="fa fa-thermometer-3"></i>
            Sensor
        </label>
        
        <input type="text" id="node-input-sensor">
     </div>
     
    <div class="form-row">
        <label for="node-input-number">
            <i class="fa fa-hashtag"></i> 
            Nummer
        </label>
     
        <input type="text" id="node-input-number" placeholder="z.B. 5">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-qos">
            <i class="fa fa-empire"></i>
            QoS
        </label>
        <select id="node-input-qos" style="width:125px !important">
            //Anfang
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-name">
            <i class="fa fa-tag"></i>
            Name
        </label>
        
        <input type="text" id="node-input-name" placeholder="z.B. Temperatur Flur oder TMP5">
        
    </div> 
</script>

<script type="text/x-red" data-help-name="SensorStatus">
    <p>Empfängt auf Anfrage Statusdaten von einem Sensor.</p>
    
    <p>Zunächst müssen MQTT-Broker, Sensortyp und die Sensornummer spezifiziert werden. Beispiele für
    die Sensorenkonfiguratioen wären Termometer1, Wetterstation9 oder Knopf0. Die akutell im Netzwerk verfügbaren Sensoren findest du unter http://[IP-Adresse_des_Servers]/mqttdb.php</p>
    
    <p>Der Sensor-Knoten gibt folgende Parameter aus:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    
    <p>Mittels <code>msg.topic</code> kannst du feststellen, unter welchem Topic die Nachricht versendet wurde. Das Topic hat i.d.R die Form Sensor/NAME/NUMMER</p>
    
    <p>Die interessanten Daten befindet sich im <code>msg.payload</code>. Der Payload wird bei Empfang in ein <strong>JSON Objekt</strong> umgewandelt. Dies ermöglicht es dir den Inhalt der Nachricht unkompliziert auszuwerten und weiter zu verwenden. So kannst du beispielsweise, wenn du weißt, dass der Parameter "Temperatur" im Payload vorhanden ist, diesen über <code>msg.payload.Temperatur</code> auslesen.</p>
    
    <p><code>msg.qos</code> zeigt an mit welchem Aufwand der Sensor versucht hat die Nachricht zum Broker zu senden. Quality of Service 0 bedeutet, dass der Sensor die Nachricht genau ein einziges Mal versendet hat. Ob die Nachricht beim Broker angekommen ist, interessiert den Senosr nicht. QoS 1 bedeutet widerum, dass der Sensor auf eine Empfangsbestätigung vom Broker wartet. So sendet der Sensor so lange ein und die selbe Nachricht bis er sich sicher sein kann, dass diese auch angekommen ist. </p>
    
    <p>Der Parameter <code>msg.retain</code> gibt an, ob der Sensor sich vom Broker wünscht die letzte Nachricht zu archivieren.</p>
</script>




<!-- Aktor -->
<script type="text/javascript">
    RED.nodes.registerType('Aktor',{
        category: 'IoT4School',
        defaults: {
            
            broker: {type:"mqtt-broker", required:true},
            aktor: {type:"IoT-Aktor", required:true},
            number: {value:"", required:true, validate:RED.validators.number()},
            qos: {value: "1"},
            name: {value:""},
            topic:{value:""},
            retain: {value:false},

        },
        color:"#00B1C1",
        inputs:1,
        outputs:0,
        icon: "feed.png",
        align: "right",
        label: function() {
            return this.name||"Aktor";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

<script type="text/x-red" data-template-name="Aktor">

    <div class="form-row">
    
        <label for="node-input-broker">
            <i class="fa fa-globe"></i> 
            Server
        </label>
        
        <input type="text" id="node-input-broker">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-aktor">
            <i class="fa fa-gears"></i>
            Aktor
        </label>
        
        <input type="text" id="node-input-aktor">
     </div>
     
    <div class="form-row">
        <label for="node-input-number">
            <i class="fa fa-hashtag"></i> 
            Nummer
        </label>
     
        <input type="text" id="node-input-number" placeholder="z.B. 7">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-qos">
            <i class="fa fa-empire"></i>
            QoS
        </label>
        <select id="node-input-qos" style="width:125px !important">
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
        
    </div>
    
    <div class="form-row" id="node-retain">
        <label for="node-input-retain">
            <i class="fa fa-cloud" aria-hidden="true"></i>
            Retained
        </label>

        <input type="checkbox" id="node-input-retain" style="display: inline-block; width: auto; vertical-align: top;">

    </div>
    
    <div class="form-row">
    
        <label for="node-input-name">
            <i class="fa fa-tag"></i>
            Name
        </label>
        
        <input type="text" id="node-input-name" placeholder="z.B. LED-Strip oder Servo7">
        
    </div>
    
    
    
</script>

<script type="text/x-red" data-help-name="Aktor">
    <p>Verbindet sich mit dem Broker und sendet den im Eingang definierten <code>msg.payload</code> an einen Aktor.</p>
    
    <p>Zunächst müssen MQTT-Broker, Aktortyp und die Aktornummer spezifiziert werden. Beispiele für
    die Aktorkonfiguratioen wären LED9, Motor12 oder Servo12. Die akutell im Netzwerk verfügbaren Aktoren findest du unter http://[IP-Adresse_des_Servers]/mqttdb.php</p>
    
    <p>Um eine Nachricht an den Aktor zu versenden, müssen folgende Parameter übergeben werden:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    
    <p>Der Aktor-Knoten nimmt dir an dieser Stelle etwas Arbeit ab, indem er <code>msg.topic</code>, <code>msg.qos</code> und <code>msg.retain</code> selbst setzt. </p>
    
    <p>Deine Aufgabe ist es <code>msg.payload</code> sinnvoll zu setzen. Dabei sind einige Dinge zu beachten. Zum einen muss der Payload der Nachricht als <strong>JSON Objekt</strong> oder als <strong>JSON String</strong> vorliegen. Ein gültiger Payload sieht z.B. so aus:</p>
    
    <p><samp>{"Parameter_1":"Hallo", "Parameter_2":"IoT-Welt"} oder {"Stellwert":7,"Dauer":4}</samp></p>
    
    <p> Zum anderen musst du dich erkundigen, welche Eingabeparameter dein Aktor genau benötigt. Versendest du z.B. den Parameter "Drehzahl" an eine Lampe, kann diese nichts mit diesen Informationen anfangen!</p>
    
    <p><em>"Was der Aktor nicht kennt, das frisst er nicht!"</em></p>
</script>





<!-- Aktor Status -->
<script type="text/javascript">
    RED.nodes.registerType('AktorStatus',{
        category: 'IoT4School',
        defaults: {
            
            broker: {type:"mqtt-broker", required:true},
            aktor: {type:"IoT-Aktor", required:true},
            number: {value:"", required:true, validate:RED.validators.number()},
            qos: {value: "1"},
            name: {value:""},
            topic:{value:""}
        },
        color:"#00B1C1",
        inputs:1,
        outputs:1,
        icon: "alert.png",
        align: "left",
        label: function() {
            return this.name||"Aktor-Status";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

<script type="text/x-red" data-template-name="AktorStatus">

    <div class="form-row">
    
        <label for="node-input-broker">
            <i class="fa fa-globe"></i> 
            Server
        </label>
        
        <input type="text" id="node-input-broker">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-aktor">
            <i class="fa fa-gears"></i>
            Aktor
        </label>
        
        <input type="text" id="node-input-aktor">
     </div>
     
    <div class="form-row">
        <label for="node-input-number">
            <i class="fa fa-hashtag"></i> 
            Nummer
        </label>
     
        <input type="text" id="node-input-number" placeholder="z.B. 7">
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-qos">
            <i class="fa fa-empire"></i>
            QoS
        </label>
        <select id="node-input-qos" style="width:125px !important">
            <option value="0">0</option>
            <option value="1">1</option>
        </select>
        
    </div>
    
    <div class="form-row">
    
        <label for="node-input-name">
            <i class="fa fa-tag"></i>
            Name
        </label>
        
        <input type="text" id="node-input-name" placeholder="z.B. LED-Strip oder Servo7">
        
    </div>
    
    
    
</script>

<script type="text/x-red" data-help-name="AktorStatus">
    <p>Empfängt auf Anfrage Statusdaten eines Aktors.</p>
    
    <p>Zunächst müssen MQTT-Broker, Aktortyp und die Aktornummer spezifiziert werden. Beispiele für
    die Aktorkonfiguratioen wären LED9, Motor12 oder Servo12. Die akutell im Netzwerk verfügbaren Aktoren findest du unter http://[IP-Adresse_des_Servers]/mqttdb.php</p>
    
    <p>Um eine Nachricht an den Aktor zu versenden, müssen folgende Parameter übergeben werden:</p>
    <ul>
       <li><code>msg.topic</code></li>
       <li><code>msg.payload</code></li>
       <li><code>msg.qos</code></li>
       <li><code>msg.retain</code></li>
    </ul>
    
    <p>Der Aktor-Knoten nimmt dir an dieser Stelle etwas Arbeit ab, indem er <code>msg.topic</code>, <code>msg.qos</code> und <code>msg.retain</code> selbst setzt. </p>
    
    <p>Deine Aufgabe ist es <code>msg.payload</code> sinnvoll zu setzen. Dabei sind einige Dinge zu beachten. Zum einen muss der Payload der Nachricht als <strong>JSON Objekt</strong> oder als <strong>JSON String</strong> vorliegen. Ein gültiger Payload sieht z.B. so aus:</p>
    
    <p><samp>{"Parameter_1":"Hallo", "Parameter_2":"IoT-Welt"} oder {"Stellwert":7,"Dauer":4}</samp></p>
    
    <p> Zum anderen musst du dich erkundigen, welche Eingabeparameter dein Aktor genau benötigt. Versendest du z.B. den Parameter "Drehzahl" an eine Lampe, kann diese nichts mit diesen Informationen anfangen!</p>
    
    <p><em>"Was der Aktor nicht kennt, das frisst er nicht!"</em></p>
</script>


<! AN -->

<script type="text/x-red" data-template-name="An">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Power On">
    </div>
</script>

<script type="text/x-red" data-help-name="An">
   <p>Dieser Node wandelt einen beliebigen Eingang in ein Einschalten-Befehl um.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('An',{
        category: 'IoT4School', 
        defaults: {     
            name: {value:""}, 
        },
	    color:"#00B1C1",
        inputs:1,     
        outputs:1,    
    
        icon: "ui_switch.png", //https://github.com/node-red/node-red-dashboard  
        label: function() { 
            return this.name||"An";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

<! AUS -->

<script type="text/x-red" data-template-name="Aus">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Power Off">
    </div>
</script>

<script type="text/x-red" data-help-name="Aus">

   <p> Wandelt einen belieibigen Eingang in einen Ausschalten-Befehl um.</p>

</script>

<script type="text/javascript">
    RED.nodes.registerType('Aus',{
        category: 'IoT4School',
        defaults: {
            name: {value:""},
        },
	color:"#00B1C1",
        inputs:1,
        outputs:1,
        icon: "ui_switch.png", //https://github.com/node-red/node-red-dashboard
        label: function() { 
            return this.name||"Aus";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>


<! TOGGLE -->

<script type="text/x-red" data-template-name="Toggle">

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Toggle Power">
    </div>
</script>


<script type="text/x-red" data-help-name="Toggle">
                                            
   <p> Dieser Node wandelt einen beliebigen Eingang in einen Toogle-Befehl um, welcher bewirkt, dass ein
   Aktor, welcher eingeschaltet ist sich ausschaltet und umgekehrt.</p>

</script>

<script type="text/javascript">
    RED.nodes.registerType('Toggle',{
        category: 'IoT4School',      
        defaults: {            
        name: {value:""},  
        },
	   color:"#00B1C1",
        inputs:1,        
        outputs:1,         
        
        icon: "ui_switch.png",     //https://github.com/node-red/node-red-dashboard
        label: function() {  
            return this.name||"Toggle";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>


<! RGB -->
<script type="text/x-red" data-template-name="RGB">

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

    <div class="form-row">
        <label for="node-input-rot"><i class="fa fa-tag"></i> Rot</label>
        <input type="text" id="node-input-rot" placeholder="0..255">
    </div>

    <div class="form-row">
        <label for="node-input-gruen"><i class="fa fa-tag"></i> Grün</label>
        <input type="text" id="node-input-gruen" placeholder="0..255">
    </div>

    <div class="form-row">
        <label for="node-input-blau"><i class="fa fa-tag"></i> Blau</label>
        <input type="text" id="node-input-blau" placeholder="0..255">
    </div>
</script>


<!-- Next, some simple help text is provided for the node.                   -->
<script type="text/x-red" data-help-name="RGB">                                          
   <p> Wandelt einen beliebigen Eingang in einen vorher definierten RGB-Wert um.</p>
   <p> Wenn <code>msg.payload</code> die Buchstabenfolge "rgb" oder eine sechsstellige
   Hexadezimalzahl enthält, wird nicht der Wert der innerhalb des Nodes definiert wurde
   versendet, sondern der am Eingang liegende Farbwert.
</script>

<script type="text/javascript">
    RED.nodes.registerType('RGB',{
        category: 'IoT4School',
        defaults: {
	    rot: {value:"0",validate:RED.validators.number(), required:true},
	    gruen: {value:"0", validate:RED.validators.number(), required:true},
	    blau: {value:"0",validate:RED.validators.number(), required:true},
            name: {value:""}, 
        },
	   color:"#00B1C1",
        inputs:1,    
        outputs:1,      
        icon: "ui_colour_picker.png",     // https://github.com/node-red/node-red-dashboard
        label: function() {    
	    var rgb_name = "rgb(" + this.rot + ","+ this.gruen + ","+ this.blau+")";
            return this.name||rgb_name ;
		//'['this.rot+','+this.gruen+','+ this.blau +']';
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

<! BRIGHTNESS -->

<script type="text/x-red" data-template-name="Helligkeit">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-brightness"><i class="fa fa-tag"></i> Helligkeit</label>
        <input type="text" id="node-input-brightness" placeholder="0..100">
    </div>
</script>

<script type="text/x-red" data-help-name="Helligkeit">
   <p>Wandelt einen beliebigen Eingang in einen vorher definierten Helligkeitswert um.</p>
   <p>Wenn am Eingang eine ganzzahlige Zahl, unabhängig vom Datentyp, zwischen 0 und 100 liegt,
    wird unabhängig vom vorher definierten Helligkeitswert, der am Eingang liegende Wert übertragen.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('Helligkeit',{
        category: 'IoT4School',
        defaults: { 
	        brightness: {value:"0",validate:RED.validators.number(), required:true},
            name: {value:""},
        },
	    color:"#00B1C1",
        inputs:1,
        outputs:1,
        icon: "light.png",
        label: function() {
            return this.name||this.brightness||"Helligkeit";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>


<! Servo -->

<script type="text/x-red" data-template-name="Servo">
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-winkel"><i class="fa fa-tag"></i> Stellwert</label>
        <input type="text" id="node-input-winkel" placeholder="0..180">
    </div>
</script>

<script type="text/x-red" data-help-name="Servo">
   <p>Wandelt einen beliebigen Eingang in einen vorher definierten Stellwert für den Servomotor um.</p>
   <p>Wenn am Eingang eine ganze Zahl zwischen 0 und 180 liegt,
    wird diese, unabhängig vom vorher definierten Stellwert im Knoten, übertragen.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('Servo',{
        category: 'IoT4School',
        defaults: { 
	        winkel: {value:"0",validate:RED.validators.number(), required:true},
            name: {value:""},
        },
	    color:"#00B1C1",
        inputs:1,
        outputs:1,
        icon: "cog.png",
        label: function() {
            return this.name||this.winkel||"Servo";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>


<! Piezo -->

<script type="text/x-red" data-template-name="Piezo">

    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>
    <div class="form-row">
        <label for="node-input-wiederholungen"><i class="fa fa-tag"></i> Replays</label>
        <input type="text" id="node-input-wiederholungen" placeholder="mind. 1">
    </div>
    <div class="form-row">
    
        <label for="node-input-melody">
            <i class="fa fa-music"></i>
            Melodie
        </label>
        <select id="node-input-melody">
            //Anfang
            <option value="1">Signalton</option>
            <option value="2">Alarm 1</option>
            <option value="3">Alarm 2</option>
            <option value="4">Türklingel</option>
            <option value="5">Star Wars</option>
            <option value="6">Jingle Bells</option>
        </select>
        
    </div>
</script>

<script type="text/x-red" data-help-name="Piezo">
   <p>Spielt eine der 6 Melodien beliebig oft ab.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('Piezo',{
        category: 'IoT4School',
        defaults: { 
            melody: {value:"1"},
	        wiederholungen: {value:"1", validate:RED.validators.number()},
            name: {value:""},
        },
	    color:"#00B1C1",
        inputs:1,
        outputs:1,
        icon: "comment.png",
        label: function() {
            return this.name||"Piezo";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>




<! Click -->
<script type="text/x-red" data-template-name="Klick-Dekodierer">
    <br/>
    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

</script>

<script type="text/x-red" data-help-name="Klick-Dekodierer">
   <p>Dieser Node leitet den <code>msg.payload.clickEvent</code> an einen der 4 Ausgänge weiter.</p>
   <p>Wenn der Knopf einmal gedrückt wurde, wird das Signal an den ersten Ausgang (ganz oben) geleitet.</p>
    <p>Wenn der Knopf zweimal schnell hintereinander gedrückt wurde, wird das Eingangssignal an den zweiten Ausgang versendet. </p>
    <p>Wurde der Knopf hingegen lange gehalten, wird der dritte Ausgang verwendet und sobald der Knopf nach langem Halten losgelassen wurde, befindet sich das Signal am letzten Ausgang.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType("Klick-Dekodierer",{
        category: 'IoT4School',
        defaults: {             
            name: {value:""}, 
        },
	    color:"#00B1C1",
        inputs:1,   
        outputs:4,           
        outputLabels: ["singleClick","doubleClick","longPress","longRelease"], 
        icon: "ui_button.png",   // https://github.com/node-red/node-red-dashboard
        label: function() {    
            return this.name||"Dekodierer";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

<! Wetter -->
<script type="text/x-red" data-template-name="Wetter-Dekodierer">
    <br/>
    <!-- By convention, most nodes have a 'name' property. The following div -->
    <!-- provides the necessary field. Should always be the last option      -->
    <div class="form-row">
        <label for="node-input-name"><i class="fa fa-tag"></i> Name</label>
        <input type="text" id="node-input-name" placeholder="Name">
    </div>

</script>

<script type="text/x-red" data-help-name="Wetter-Dekodierer">
   <p>Die Wetterstation misst Temperatur, Luftfeuchtigkeit, Helligkeit und die gefühlte Temperatur.</p>
   <p>Dieser Node leitet die im <code>msg.payload</code> enthaltenen Daten an die vier Ausgänge weiter.</p>
    <p>Ausgang 1 gibt die Temperatur in Grad Celcius als Gleitkommazahl aus. </p>
    <p>Ausgang 2 gibt die Luftfeuchtigkeit in Prozent als Gleitkommazahl aus. </p>
    <p>Ausgang 3 gibt die Helligkeit als ganze Zahl zwischen 0 und 1023 aus. Da der Sensor sich eher dafür eignet festzustellen, dass es hell ist, anstatt die Frage zu beantworten, wie hell es ist, gilt folgende Faustregel: Je niedriger der Wert, desto heller ist es.</p>
    <p>Ausgang 4 gibt die gefühlte Temperatur, welche aus Raumgetemperatur und Luftfeuchtigkeit berechnet wird, in Grad Celcius als Gleitkommazahl aus. </p>
</script>

<script type="text/javascript">
    RED.nodes.registerType("Wetter-Dekodierer",{
        category: 'IoT4School',
        defaults: {             
            name: {value:""}, 
        },
	    color:"#00B1C1",
        inputs:1,   
        outputs:4,           
        outputLabels: ["Temperatur","Luftfeuchtigkeit","Helligkeit","gefühlte Temperatur"], 
        icon: "wetter.png",   // http://www.iconarchive.com/show/oxygen-icons-by-oxygen-icons.org/Status-weather-clouds-icon.html
        label: function() {    
            return this.name||"Dekodierer";
        },
        labelStyle: function() {
            return this.name?"node_label_italic":"";
        }
    });
</script>

























<script type="text/x-red" data-template-name="iot-mqtt-broker">
    <div class="form-row">
        <ul style="background: #fff; min-width: 600px; margin-bottom: 20px;" id="node-config-iot-mqtt-broker-tabs"></ul>
    </div>
    <div id="node-config-iot-mqtt-broker-tabs-content" style="min-height: 170px;">
        <div id="mqtt-broker-tab-connection" style="display:none">
            <div class="form-row node-input-broker">
                <label for="node-config-input-iot-broker"><i class="fa fa-globe"></i> <span data-i18n="mqtt.label.broker"></span></label>
                <input class="input-append-left" type="text" id="node-config-input-broker" placeholder="e.g. localhost" style="width:40%;" >
                <label for="node-config-input-port" style="margin-left:20px; width:35px; "> <span data-i18n="mqtt.label.port"></span></label>
                <input type="text" id="node-config-input-port" data-i18n="[placeholder]mqtt.label.port" style="width:55px">
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-usetls" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-usetls" style="width: auto" data-i18n="mqtt.label.use-tls"></label>
                <div id="node-config-row-tls" class="hide">
                    <label style="width: auto; margin-left: 20px; margin-right: 10px;" for="node-config-input-tls"><span data-i18n="mqtt.label.tls-config"></span></label><input style="width: 300px;" type="text" id="node-config-input-tls">
                </div>
            </div>
            <div class="form-row">
                <label for="node-config-input-clientid"><i class="fa fa-tag"></i> <span data-i18n="mqtt.label.clientid"></span></label>
                <input type="text" id="node-config-input-clientid" data-i18n="[placeholder]mqtt.placeholder.clientid">
            </div>
            <div class="form-row">
                <label for="node-config-input-keepalive" style="width: auto"><i class="fa fa-clock-o"></i> <span data-i18n="mqtt.label.keepalive"></span></label>
                <input type="text" id="node-config-input-keepalive" style="width: 50px">
                <input type="checkbox" id="node-config-input-cleansession" style="margin-left: 30px; height: 1em;display: inline-block; width: auto; vertical-align: middle;">
                <label for="node-config-input-cleansession" style="width: auto;" data-i18n="mqtt.label.cleansession"></label>
            </div>
            <div class="form-row">
                <input type="checkbox" id="node-config-input-compatmode" style="display: inline-block; width: auto; vertical-align: top;">
                <label for="node-config-input-compatmode" style="width: auto;" data-i18n="mqtt.label.compatmode"></label>
            </div>
        </div>
        <div id="mqtt-broker-tab-security" style="display:none">
            <div class="form-row">
                <label for="node-config-input-user"><i class="fa fa-user"></i> <span data-i18n="common.label.username"></span></label>
                <input type="text" id="node-config-input-user">
            </div>
            <div class="form-row">
                <label for="node-config-input-password"><i class="fa fa-lock"></i> <span data-i18n="common.label.password"></span></label>
                <input type="password" id="node-config-input-password">
            </div>
        </div>
        <div id="mqtt-broker-tab-birth" style="display:none">
            <div class="form-row">
                <label for="node-config-input-birthTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-birthTopic" data-i18n="[placeholder]mqtt.placeholder.birth-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-birthQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-birthQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-birthRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-birthPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-birthPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
        <div id="mqtt-broker-tab-will" style="display:none">
            <div class="form-row">
                <label for="node-config-input-willTopic"><i class="fa fa-tasks"></i> <span data-i18n="common.label.topic"></span></label>
                <input type="text" id="node-config-input-willTopic" data-i18n="[placeholder]mqtt.placeholder.will-topic">
            </div>
            <div class="form-row">
                <label for="node-config-input-willQos"><i class="fa fa-empire"></i> <span data-i18n="mqtt.label.qos"></span></label>
                <select id="node-config-input-willQos" style="width:125px !important">
                    <option value="0">0</option>
                    <option value="1">1</option>
                    <option value="2">2</option>
                </select>
                &nbsp;&nbsp;<i class="fa fa-history"></i>&nbsp;<span data-i18n="mqtt.retain"></span> &nbsp;<select id="node-config-input-willRetain" style="width:125px !important">
                    <option value="false" data-i18n="mqtt.false"></option>
                    <option value="true" data-i18n="mqtt.true"></option>
                </select>
            </div>
            <div class="form-row">
                <label for="node-config-input-willPayload"><i class="fa fa-envelope"></i> <span data-i18n="common.label.payload"></span></label>
                <input type="text" id="node-config-input-willPayload" data-i18n="[placeholder]common.label.payload">
            </div>
        </div>
    </div>
</script>

<script type="text/x-red" data-help-name="iot-mqtt-broker">
    <p>A minimum MQTT broker connection requires only a broker server address to be added to the default configuration.</p>
    <p>To secure the connection with SSL/TLS, a TLS Configuration must also be configured and selected.</p>
    <p>If you create a Client ID it must be unique to the broker you are connecting to.</p>
    <p>For more information about MQTT see the <a href="http://www.eclipse.org/paho/" target="_blank">Eclipse Paho</a> site.</p>
</script>

<script type="text/javascript">
    RED.nodes.registerType('iot-mqtt-broker',{
        category: 'config',
        defaults: {
            broker: {value:"",required:true},
            port: {value:1883,required:true,validate:RED.validators.number()},
            tls: {type:"tls-config",required: false},
            clientid: {value:"", validate: function(v) {
                    if ($("#node-config-input-clientid").length) {
                        // Currently editing the node
                        return $("#node-config-input-cleansession").is(":checked") || (v||"").length > 0;
                    } else {
                        return (this.cleansession===undefined || this.cleansession) || (v||"").length > 0;
                    }
                }},
            usetls: {value: false},
            verifyservercert: { value: false},
            compatmode: { value: true},
            keepalive: {value:60,validate:RED.validators.number()},
            cleansession: {value: true},
            willTopic: {value:""},
            willQos: {value:"0"},
            willRetain: {value:false},
            willPayload: {value:""},
            birthTopic: {value:""},
            birthQos: {value:"0"},
            birthRetain: {value:false},
            birthPayload: {value:""}
        },
        credentials: {
            user: {type:"text"},
            password: {type: "password"}
        },
        label: function() {
            var b = this.broker;
            if (b === "") { b = "undefined"; }
            return (this.clientid?this.clientid+"@":"")+b+":"+this.port;
        },
        oneditprepare: function () {
            var tabs = RED.tabs.create({
                id: "node-config-mqtt-broker-tabs",
                onchange: function(tab) {
                    $("#node-config-mqtt-broker-tabs-content").children().hide();
                    $("#" + tab.id).show();
                }
            });
            tabs.addTab({
                id: "mqtt-broker-tab-connection",
                label: this._("mqtt.tabs-label.connection")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-security",
                label: this._("mqtt.tabs-label.security")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-birth",
                label: this._("mqtt.tabs-label.birth")
            });
            tabs.addTab({
                id: "mqtt-broker-tab-will",
                label: this._("mqtt.tabs-label.will")
            });
            setTimeout(function() { tabs.resize(); },0);
            if (typeof this.cleansession === 'undefined') {
                this.cleansession = true;
                $("#node-config-input-cleansession").prop("checked",true);
            }
            if (typeof this.usetls === 'undefined') {
                this.usetls = false;
                $("#node-config-input-usetls").prop("checked",false);
            }
            if (typeof this.compatmode === 'undefined') {
                this.compatmode = true;
                $("#node-config-input-compatmode").prop('checked', true);
            }
            if (typeof this.keepalive === 'undefined') {
                this.keepalive = 15;
                $("#node-config-input-keepalive").val(this.keepalive);
            }
            if (typeof this.willQos === 'undefined') {
                this.willQos = "0";
                $("#node-config-input-willQos").val("0");
            }
            if (typeof this.birthQos === 'undefined') {
                this.birthQos = "0";
                $("#node-config-input-birthQos").val("0");
            }
            function updateTLSOptions() {
                if ($("#node-config-input-usetls").is(':checked')) {
                    $("#node-config-row-tls").show();
                } else {
                    $("#node-config-row-tls").hide();
                }
            }
            updateTLSOptions();
            $("#node-config-input-usetls").on("click",function() {
                updateTLSOptions();
            });
            var node = this;
            function updateClientId() {
                if ($("#node-config-input-cleansession").is(":checked")) {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid"));
                } else {
                    $("#node-config-input-clientid").attr("placeholder",node._("mqtt.placeholder.clientid-nonclean"));
                }
                $("#node-config-input-clientid").change();
            }
            setTimeout(updateClientId,0);
            $("#node-config-input-cleansession").on("click",function() {
                updateClientId();
            });
        },
        oneditsave: function() {
            if (!$("#node-config-input-usetls").is(':checked')) {
                $("#node-config-input-tls").val("");
            }
        }
    });
</script>
